<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AQ Numerasi Assessment - Corrected Numbering</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 20% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 0, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(255, 255, 0, 0.1) 0%, transparent 50%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #00d4ff, #ff00ff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 2s ease-in-out infinite alternate;
            margin-bottom: 10px;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px rgba(0, 212, 255, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 0, 255, 0.8); }
        }

        .version-info {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .question {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .question:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 20px;
            color: #e0e0e0;
            line-height: 1.5;
        }

        .options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-group:hover {
            transform: scale(1.1);
        }

        .option-input {
            width: 20px;
            height: 20px;
            margin-bottom: 8px;
            cursor: pointer;
            accent-color: #00d4ff;
        }

        .option-label {
            font-size: 0.9rem;
            color: #b0b0b0;
            text-align: center;
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #888;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.5);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #ff00ff);
            width: 0%;
            transition: width 0.3s ease;
        }

        .results-container {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
        }

        .score-high { color: #00ff00; }
        .score-medium { color: #ffff00; }
        .score-low { color: #ff6b6b; }

        .personal-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            margin-bottom: 8px;
            color: #00d4ff;
            font-weight: bold;
        }

        .input-group input {
            padding: 12px 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .input-group input:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #00d4ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .instructions {
            background: rgba(0, 212, 255, 0.1);
            border-left: 4px solid #00d4ff;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 10px;
        }

        .instructions h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }

        .instructions ul {
            list-style-type: none;
            padding-left: 0;
        }

        .instructions li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .instructions li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #00d4ff;
        }

        .success-message {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            color: #00ff00;
        }

        .error-message {
            background: rgba(255, 200, 0, 0.2);
            border: 1px solid rgba(255, 200, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            color: #ffcc00;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 1000;
        }

        .connection-online {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            color: #00ff00;
        }

        .connection-offline {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
            color: #ff0000;
        }

        .debug-info {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid rgba(255, 255, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .options {
                flex-direction: column;
                gap: 15px;
            }
            
            .personal-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="particles"></div>
    
    <!-- Connection Status Indicator -->
    <div class="connection-status connection-online" id="connectionStatus">
        üü¢ Online
    </div>
    
    <div class="container">
        <div class="header">
            <h1>ANGKET ADVERSITY QUOTIENT</h1>
            <div style="font-size: 1.2rem; color: #b0b0b0; margin-top: 10px;">
                Terintegrasi Numerasi - Penilaian Ketahanan Matematika
            </div>
            <div class="version-info">
                <strong>üöÄ Versi Corrected 2025</strong> - Butir 1-36 | Skor Maksimal: 144
                <br><small>Penomoran butir angket yang benar: 1 sampai 36</small>
                <br><small>üîó Data otomatis tersimpan ke Google Sheets</small>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container" id="formContainer">
            <!-- Step 0: Personal Information (No Scoring) -->
            <div class="form-step active" id="step0">
                <h2 style="color: #00d4ff; margin-bottom: 20px; text-align: center;">Informasi Pribadi</h2>
                <p style="text-align: center; color: #888; margin-bottom: 30px;">
                    <em>Bagian ini tidak dinilai - hanya untuk identifikasi</em>
                </p>
                
                <div class="instructions">
                    <h3>Petunjuk Pengisian</h3>
                    <ul>
                        <li>Isi data pribadi terlebih dahulu (tidak ada skor)</li>
                        <li>Angket dimulai dari butir nomor 1 sampai 36</li>
                        <li>Setiap butir memiliki skor 1-4</li>
                        <li>Skor maksimal total: 144 poin (36 √ó 4)</li>
                        <li>Jawablah dengan jujur sesuai kondisi Anda</li>
                        <li>Tidak ada jawaban benar atau salah</li>
                    </ul>
                </div>

                <div class="personal-info">
                    <div class="input-group">
                        <label for="namaLengkap">Nama Lengkap *</label>
                        <input type="text" id="namaLengkap" required placeholder="Masukkan nama lengkap">
                    </div>
                    <div class="input-group">
                        <label for="kelas">Kelas *</label>
                        <input type="text" id="kelas" required placeholder="Contoh: XII IPA 1">
                    </div>
                    <div class="input-group">
                        <label for="whatsapp">Nomor WhatsApp *</label>
                        <input type="tel" id="whatsapp" required placeholder="Contoh: 08123456789">
                    </div>
                </div>

                <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px; margin: 20px 0;">
                    <h3 style="color: #ff00ff; margin-bottom: 15px;">Sistem Penskoran Angket</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="color: #00d4ff;">Pernyataan Positif</h4>
                            <p>Tidak Pernah: 1 | Jarang: 2 | Sering: 3 | Selalu: 4</p>
                        </div>
                        <div>
                            <h4 style="color: #00d4ff;">Pernyataan Negatif</h4>
                            <p>Tidak Pernah: 4 | Jarang: 3 | Sering: 2 | Selalu: 1</p>
                        </div>
                    </div>
                    <p style="text-align: center; margin-top: 15px; color: #ffff00;">
                        <strong>üìä Total: 36 butir √ó 4 poin = 144 skor maksimal</strong>
                    </p>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="btn" id="prevBtn" onclick="previousStep()" disabled>Sebelumnya</button>
                <button class="btn" id="nextBtn" onclick="nextStep()">Mulai Angket</button>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Menghitung skor dari 36 butir angket...</p>
            <p><small>Mengirim data ke Google Sheets...</small></p>
            <p><small>Memvalidasi skor maksimal 144 poin</small></p>
        </div>

        <!-- Results Container -->
        <div class="results-container" id="resultsContainer">
            <h2 style="color: #00d4ff; text-align: center; margin-bottom: 30px;">Hasil Analisis AQ Numerasi</h2>
            
            <div id="messageContainer"></div>
            
            <!-- Debug Info -->
            <div class="debug-info" id="debugInfo" style="display: none;">
                <h4 style="color: #ffff00;">üìä Debug Information:</h4>
                <div id="debugContent"></div>
            </div>
            
            <div class="results-grid">
                <div class="result-card">
                    <h3 style="color: #ff00ff;">Skor Total AQ</h3>
                    <div class="score-display" id="totalScore">0</div>
                    <p id="scoreCategory">-</p>
                    <small>Dari maksimal 144 poin</small>
                </div>
                <div class="result-card">
                    <h3 style="color: #ff00ff;">Persentase</h3>
                    <div class="score-display" id="scorePercentage">0%</div>
                    <p>Pencapaian dari skor maksimal</p>
                </div>
                <div class="result-card">
                    <h3 style="color: #ff00ff;">Level Ketahanan</h3>
                    <div class="score-display" id="resistanceLevel">-</div>
                    <p id="levelDescription">-</p>
                </div>
            </div>

            <div style="background: rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 15px; margin-top: 30px;">
                <h3 style="color: #ff00ff; margin-bottom: 15px;">Analisis Dimensi AQ</h3>
                <div id="dimensionAnalysis"></div>
            </div>

            <div style="background: rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 15px; margin-top: 30px;">
                <h3 style="color: #ff00ff; margin-bottom: 15px;">Rekomendasi Pengembangan</h3>
                <div id="recommendations"></div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="resetAssessment()">Kerjakan Ulang</button>
                <button class="btn" onclick="downloadResults()" style="background: linear-gradient(45deg, #ff00ff, #cc0099);">Unduh Hasil</button>
                <button class="btn" onclick="viewSpreadsheet()" style="background: linear-gradient(45deg, #00ff00, #009900);">Lihat Data</button>
                <button class="btn" onclick="toggleDebug()" style="background: linear-gradient(45deg, #ffff00, #cc9900);">Toggle Debug</button>
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script Web App URL - Restored Feature
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbye-TkntyXP9kTcqH7HcweNcezqjj1jPuIBEGtKIHMiBK2mdMzVYTskfY66ckB4XKr6/exec';
        const SPREADSHEET_URL = 'https://docs.google.com/spreadsheets/d/1WB3JJL0LM1TX2w23MvEMEVr-ZDVabvX712xShWJPIEI/edit';

        // Connection status monitoring
        function updateConnectionStatus() {
            const status = navigator.onLine;
            const statusElement = document.getElementById('connectionStatus');
            if (status) {
                statusElement.className = 'connection-status connection-online';
                statusElement.innerHTML = 'üü¢ Online';
            } else {
                statusElement.className = 'connection-status connection-offline';
                statusElement.innerHTML = 'üî¥ Offline';
            }
        }

        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        updateConnectionStatus();

        // AQ Questions - 36 items (numbered 1-36)
        const questions = [
            {
                id: 1,
                text: "Saya tetap tenang saat menghadapi persamaan kuadrat yang memerlukan pemfaktoran, seperti x¬≤ + 5x + 6 = 0",
                type: "positive",
                dimension: "Control"
            },
            {
                id: 2,
                text: "Saya merasa cemas ketika diminta untuk menyederhanakan bentuk pecahan aljabar seperti (x¬≤ - 4)/(x - 2)",
                type: "negative",
                dimension: "Control"
            },
            {
                id: 3,
                text: "Saya bisa tetap tenang ketika harus mengoperasikan bentuk aljabar yang rumit seperti (2x + 3)(x - 4) - (3x - 2)¬≤",
                type: "positive",
                dimension: "Control"
            },
            {
                id: 4,
                text: "Saya merasa bingung ketika harus mengubah permasalahan tentang umur (\"Umur Ali 5 tahun lebih tua dari umur Budi. Jika jumlah umur mereka 25 tahun‚Ä¶\") menjadi bentuk persamaan.",
                type: "negative",
                dimension: "Control"
            },
            {
                id: 5,
                text: "Saya tetap percaya diri saat menggunakan rumus kecepatan (v = s/t) untuk menyelesaikan soal fisika yang melibatkan persamaan.",
                type: "positive",
                dimension: "Control"
            },
            {
                id: 6,
                text: "Saya kesulitan memahami grafik persamaan linear y = 2x + 1 ketika dikaitkan dengan masalah tarif taksi (biaya awal Rp10.000 dan tambahan Rp2.000 per kilometer).",
                type: "negative",
                dimension: "Control"
            },
            {
                id: 7,
                text: "Saya yakin bisa mencari cara untuk menyelesaikan sistem persamaan linear dua variabel, baik dengan metode substitusi maupun eliminasi.",
                type: "positive",
                dimension: "Control"
            },
            {
                id: 8,
                text: "Saya merasa bingung saat harus memilih metode yang tepat untuk memfaktorkan bentuk kuadrat seperti x¬≤ - 4x + 4 atau x¬≤ - 9",
                type: "negative",
                dimension: "Control"
            },
            {
                id: 9,
                text: "Saya panik ketika soal persamaan kuadrat tidak bisa diselesaikan dengan pemfaktoran dan harus menggunakan rumus ABC",
                type: "negative",
                dimension: "Control"
            },
            {
                id: 10,
                text: "Saya berusaha memahami sifat-sifat dalam aljabar seperti sifat distributif a(b+c) = ab+ac dan mengapa sifat tersebut berlaku.",
                type: "positive",
                dimension: "Ownership"
            },
            {
                id: 11,
                text: "Saya menyalahkan orang lain saat kesulitan memahami penjumlahan dan pengurangan pecahan aljabar.",
                type: "negative",
                dimension: "Ownership"
            },
            {
                id: 12,
                text: "Saya bertanggung jawab untuk belajar cara menyelesaikan persamaan linear (seperti 2x + 3 = 7) dengan langkah-langkah yang benar.",
                type: "positive",
                dimension: "Ownership"
            },
            {
                id: 13,
                text: "Saya menghindari penggunaan rumus nilai maksimum persamaan kuadrat saat menghitung masalah keuangan atau masalah lainnya.",
                type: "negative",
                dimension: "Ownership"
            },
            {
                id: 14,
                text: "Saya mencari contoh penggunaan persamaan linear dalam kehidupan sehari-hari, seperti menghitung tarif listrik atau biaya transportasi.",
                type: "positive",
                dimension: "Ownership"
            },
            {
                id: 15,
                text: "Saya pikir menemukan hubungan antara luas persegi panjang (L = p √ó l) dengan bentuk aljabar adalah tugas guru, bukan tugas saya",
                type: "negative",
                dimension: "Ownership"
            },
            {
                id: 16,
                text: "Saya berusaha mencari berbagai cara untuk menyelesaikan persamaan kuadrat selain dengan pemfaktoran (seperti melengkapkan kuadrat atau rumus ABC).",
                type: "positive",
                dimension: "Ownership"
            },
            {
                id: 17,
                text: "Saya lupa memeriksa kembali jawaban persamaan dengan mensubstitusikan nilai x yang diperoleh ke dalam persamaan awal.",
                type: "negative",
                dimension: "Ownership"
            },
            {
                id: 18,
                text: "Saya aktif bertanya dan berdiskusi tentang langkah-langkah penyelesaian sistem persamaan linear tiga variabel.",
                type: "positive",
                dimension: "Ownership"
            },
            {
                id: 19,
                text: "Kesulitan memahami bentuk pangkat dan akar (seperti x^(1/2) = ‚àöx) membuat saya tidak percaya diri dengan materi persamaan kuadrat.",
                type: "negative",
                dimension: "Reach"
            },
            {
                id: 20,
                text: "Saya bisa tetap memahami cara menyelesaikan persamaan linear 2x + 3 = 7 meskipun kesulitan dengan persamaan kuadrat x¬≤ - 5x + 6 = 0",
                type: "positive",
                dimension: "Reach"
            },
            {
                id: 21,
                text: "Saya merasa tidak berbakat pada bidang matematika secara keseluruhan jika melakukan kesalahan dalam operasi bentuk aljabar seperti (2x + 3) - (x - 4)",
                type: "negative",
                dimension: "Reach"
            },
            {
                id: 22,
                text: "Kesulitan menggunakan rumus luas lingkaran (L = œÄr¬≤) dalam soal cerita tidak mempengaruhi kepercayaan diri saya dalam menggunakan persamaan linear dalam soal jual beli.",
                type: "positive",
                dimension: "Reach"
            },
            {
                id: 23,
                text: "Saya meragukan kegunaan persamaan linear y = mx + c dalam kehidupan sehari-hari ketika kesulitan menyelesaikan soal tarif ojek online",
                type: "negative",
                dimension: "Reach"
            },
            {
                id: 24,
                text: "Saya paham bahwa kesulitan menerapkan rumus kecepatan v = s/t dalam soal perjalanan hanya terjadi pada kasus-kasus tertentu saja",
                type: "positive",
                dimension: "Reach"
            },
            {
                id: 25,
                text: "Saya merasa semua metode saya salah jika metode substitusi tidak berhasil dalam menyelesaikan sistem persamaan linear",
                type: "negative",
                dimension: "Reach"
            },
            {
                id: 26,
                text: "Saya bisa mencoba metode eliminasi jika metode substitusi gagal menyelesaikan sistem persamaan linear dua variabel",
                type: "positive",
                dimension: "Reach"
            },
            {
                id: 27,
                text: "Saya merasa tidak kompeten pada matematika secara keseluruhan ketika gagal menyelesaikan persamaan kuadrat dengan metode pemfaktoran",
                type: "negative",
                dimension: "Reach"
            },
            {
                id: 28,
                text: "Saya melihat kesulitan memfaktorkan bentuk kuadrat seperti x¬≤ - 10x + 24 sebagai tantangan sementara yang bisa diatasi dengan latihan",
                type: "positive",
                dimension: "Endurance"
            },
            {
                id: 29,
                text: "Saya cepat menyerah saat mengerjakan soal persamaan pecahan aljabar seperti (x+1)/(x-2) = 1/(3+2x)",
                type: "negative",
                dimension: "Endurance"
            },
            {
                id: 30,
                text: "Saya yakin pemahaman saya tentang operasi bentuk aljabar (seperti perkalian, pembagian, dan pemfaktoran) akan meningkat jika saya terus berlatih",
                type: "positive",
                dimension: "Endurance"
            },
            {
                id: 31,
                text: "Saya berhenti mencoba menerapkan konsep pertidaksamaan linear dalam masalah diet (batasan kalori dan nutrisi) atau masalah lainnya setelah mengalami kesulitan di awal",
                type: "negative",
                dimension: "Endurance"
            },
            {
                id: 32,
                text: "Saya terus berusaha menghubungkan konsep gradien garis lurus dengan situasi nyata seperti kemiringan jalan atau tangga.",
                type: "positive",
                dimension: "Endurance"
            },
            {
                id: 33,
                text: "Saya merasa tidak akan pernah bisa menerapkan sistem pertidaksamaan linear dalam masalah campuran (seperti mencampurkan dua larutan dengan kadar berbeda atau masalah lainnya)",
                type: "negative",
                dimension: "Endurance"
            },
            {
                id: 34,
                text: "Saya tetap berusaha menyelesaikan soal sistem persamaan linear tiga variabel meskipun awalnya mengalami kebingungan dengan banyaknya langkah",
                type: "positive",
                dimension: "Endurance"
            },
            {
                id: 35,
                text: "Saya langsung berhenti mencoba jika menemui persamaan kuadrat yang tidak bisa difaktorkan dengan mudah",
                type: "negative",
                dimension: "Endurance"
            },
            {
                id: 36,
                text: "Saya tetap yakin bisa menemukan cara yang tepat untuk menyelesaikan soal pertidaksamaan kuadrat meskipun tampak rumit.",
                type: "positive",
                dimension: "Endurance"
            }
        ];

        let currentStep = 0;
        let responses = {};
        let personalInfo = {};

        // Generate question steps
        function generateQuestionSteps() {
            const questionsPerStep = 6;
            const totalSteps = Math.ceil(questions.length / questionsPerStep);
            
            for (let step = 1; step <= totalSteps; step++) {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'form-step';
                stepDiv.id = `step${step}`;
                
                const startIndex = (step - 1) * questionsPerStep;
                const endIndex = Math.min(startIndex + questionsPerStep, questions.length);
                const stepQuestions = questions.slice(startIndex, endIndex);
                
                let stepHTML = `<h2 style="color: #00d4ff; margin-bottom: 30px; text-align: center;">
                    Bagian ${step} dari ${totalSteps} (Butir ${startIndex + 1}-${endIndex})
                </h2>`;
                
                stepQuestions.forEach(question => {
                    stepHTML += `
                        <div class="question">
                            <div class="question-text">
                                <strong>Butir ${question.id}.</strong> ${question.text}
                                <br><small style="color: #888;">[${question.type} - ${question.dimension}]</small>
                            </div>
                            <div class="options">
                                <div class="scale-labels">
                                    ${question.type === 'positive' ? 
                                        '<span>Tidak Pernah (1)</span><span style="text-align: center;">1 &nbsp;&nbsp; 2 &nbsp;&nbsp; 3 &nbsp;&nbsp; 4</span><span>Selalu (4)</span>' :
                                        '<span>Tidak Pernah (4)</span><span style="text-align: center;">4 &nbsp;&nbsp; 3 &nbsp;&nbsp; 2 &nbsp;&nbsp; 1</span><span>Selalu (1)</span>'
                                    }
                                </div>
                                <div style="display: flex; justify-content: space-between; width: 100%; margin-top: 15px;">
                                    ${[1, 2, 3, 4].map(value => `
                                        <div class="option-group">
                                            <input type="radio" name="q${question.id}" value="${value}" class="option-input" id="q${question.id}_${value}">
                                            <label class="option-label" for="q${question.id}_${value}">${value}</label>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                stepDiv.innerHTML = stepHTML;
                document.getElementById('formContainer').insertBefore(stepDiv, document.querySelector('.navigation'));
            }
        }

        function nextStep() {
            if (currentStep === 0) {
                // Validate personal information (no scoring)
                const nama = document.getElementById('namaLengkap').value.trim();
                const kelas = document.getElementById('kelas').value.trim();
                const whatsapp = document.getElementById('whatsapp').value.trim();
                
                if (!nama || !kelas || !whatsapp) {
                    alert('Mohon lengkapi semua informasi pribadi!');
                    return;
                }
                
                personalInfo = { nama, kelas, whatsapp };
                document.getElementById('progressBar').style.display = 'block';
                
                // Update button text for questionnaire
                document.getElementById('nextBtn').textContent = 'Selanjutnya';
            }
            
            if (currentStep > 0) {
                // Validate current step questions
                const currentStepQuestions = getCurrentStepQuestions();
                let allAnswered = true;
                
                currentStepQuestions.forEach(question => {
                    const answered = document.querySelector(`input[name="q${question.id}"]:checked`);
                    if (!answered) {
                        allAnswered = false;
                    } else {
                        responses[question.id] = {
                            value: parseInt(answered.value),
                            type: question.type,
                            dimension: question.dimension
                        };
                    }
                });
                
                if (!allAnswered) {
                    alert('Mohon jawab semua butir pada halaman ini!');
                    return;
                }
            }
            
            // Move to next step
            document.getElementById(`step${currentStep}`).classList.remove('active');
            currentStep++;
            
            const totalSteps = Math.ceil(questions.length / 6) + 1;
            
            if (currentStep < totalSteps) {
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgress();
                updateNavigation();
            } else {
                // Submit and show results
                submitAssessment();
            }
        }

        function previousStep() {
            if (currentStep > 0) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgress();
                updateNavigation();
            }
        }

        function getCurrentStepQuestions() {
            if (currentStep === 0) return [];
            
            const questionsPerStep = 6;
            const startIndex = (currentStep - 1) * questionsPerStep;
            const endIndex = Math.min(startIndex + questionsPerStep, questions.length);
            return questions.slice(startIndex, endIndex);
        }

        function updateProgress() {
            const totalSteps = Math.ceil(questions.length / 6) + 1;
            const progress = (currentStep / (totalSteps - 1)) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentStep === 0;
            
            const totalSteps = Math.ceil(questions.length / 6) + 1;
            if (currentStep === totalSteps - 1) {
                nextBtn.textContent = 'Selesai & Lihat Hasil';
            } else if (currentStep === 0) {
                nextBtn.textContent = 'Mulai Angket';
            } else {
                nextBtn.textContent = 'Selanjutnya';
            }
        }

        async function submitAssessment() {
            document.getElementById('loading').classList.add('show');
            document.getElementById('formContainer').style.display = 'none';
            
            // Calculate scores
            const results = calculateResults();
            
            // Prepare data for Google Sheets
            const formData = new FormData();
            formData.append('nama', results.personalInfo.nama);
            formData.append('kelas', results.personalInfo.kelas);
            formData.append('whatsapp', results.personalInfo.whatsapp);
            formData.append('totalScore', results.totalScore);
            formData.append('percentage', results.percentage);
            formData.append('category', results.category);
            formData.append('level', results.level);
            formData.append('controlScore', results.dimensionScores.Control.average.toFixed(2));
            formData.append('ownershipScore', results.dimensionScores.Ownership.average.toFixed(2));
            formData.append('reachScore', results.dimensionScores.Reach.average.toFixed(2));
            formData.append('enduranceScore', results.dimensionScores.Endurance.average.toFixed(2));
            formData.append('timestamp', new Date().toLocaleString('id-ID'));
            formData.append('totalQuestions', results.totalQuestions);
            formData.append('maxScore', results.maxScore);
            
            try {
                console.log('üöÄ Sending data to Google Sheets:', SCRIPT_URL);
                console.log('üìä Data being sent:', Object.fromEntries(formData));
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                });
                
                // Simulate success since we can't read response with no-cors
                setTimeout(() => {
                    onSaveSuccess({ 
                        message: 'Data berhasil dikirim ke Google Sheets!',
                        timestamp: new Date().toLocaleString('id-ID')
                    });
                }, 1500);
                
            } catch (error) {
                console.error('‚ö†Ô∏è Error sending data:', error);
                setTimeout(() => {
                    onSaveFailure({ 
                        message: 'Koneksi bermasalah, tapi data masih bisa dilihat di layar ini.' 
                    });
                }, 1500);
            }
            
            // Show results after delay
            setTimeout(() => {
                document.getElementById('loading').classList.remove('show');
                showResults(results);
            }, 3000);
        }

        function onSaveSuccess(response) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.innerHTML = `
                <div class="success-message">
                    ‚úÖ ${response.message || 'Data berhasil disimpan di Google Sheets!'}
                    <br><small>üìÖ Waktu: ${response.timestamp || new Date().toLocaleString('id-ID')}</small>
                    <br><small>üîó <a href="${SPREADSHEET_URL}" target="_blank" style="color: #00ff00;">Lihat Data di Spreadsheet</a></small>
                </div>`;
        }

        function onSaveFailure(error) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.innerHTML = `
                <div class="error-message">
                    ‚ö†Ô∏è ${error.message || 'Terjadi kesalahan saat menyimpan data'}
                    <br><small>üíæ Data tetap dapat dilihat dan diunduh di layar ini</small>
                    <br><small>üîÑ Coba refresh halaman dan kirim ulang jika perlu</small>
                </div>`;
        }

        function calculateResults() {
            console.log('üßÆ Starting calculation for items 1-36...');
            
            let totalScore = 0;
            const dimensionScores = {
                Control: { rawScore: 0, count: 0, items: [] },
                Ownership: { rawScore: 0, count: 0, items: [] },
                Reach: { rawScore: 0, count: 0, items: [] },
                Endurance: { rawScore: 0, count: 0, items: [] }
            };
            
            let debugInfo = [];
            
            // Process each response
            Object.entries(responses).forEach(([questionId, response]) => {
                const question = questions.find(q => q.id == questionId);
                let score = response.value;
                
                // Apply reverse scoring for negative items
                if (response.type === 'negative') {
                    score = 5 - response.value;  // 1‚Üí4, 2‚Üí3, 3‚Üí2, 4‚Üí1
                }
                
                totalScore += score;
                dimensionScores[response.dimension].rawScore += score;
                dimensionScores[response.dimension].count++;
                dimensionScores[response.dimension].items.push({
                    id: questionId,
                    originalValue: response.value,
                    finalScore: score,
                    type: response.type
                });
                
                debugInfo.push({
                    questionId: questionId,
                    originalValue: response.value,
                    finalScore: score,
                    type: response.type,
                    dimension: response.dimension
                });
            });
            
            // Calculate dimension averages
            Object.keys(dimensionScores).forEach(dimension => {
                const dim = dimensionScores[dimension];
                dim.average = dim.count > 0 ? (dim.rawScore / dim.count) : 0;
            });
            
            const maxScore = 144; // 36 questions √ó 4 points maximum
            const percentage = Math.round((totalScore / maxScore) * 100);
            
            let category, level, description;
            if (percentage >= 80) {
                category = 'Tinggi';
                level = 'Excellent';
                description = 'Ketahanan sangat baik dalam menghadapi tantangan matematika';
            } else if (percentage >= 60) {
                category = 'Sedang';
                level = 'Good';
                description = 'Ketahanan baik, masih dapat ditingkatkan';
            } else {
                category = 'Rendah';
                level = 'Needs Improvement';
                description = 'Perlu pengembangan strategi mengatasi kesulitan matematika';
            }
            
            console.log('üìä Calculation complete:', {
                totalQuestions: Object.keys(responses).length,
                totalScore: totalScore,
                maxScore: maxScore,
                percentage: percentage
            });
            
            return {
                personalInfo,
                totalScore,
                maxScore,
                percentage,
                category,
                level,
                description,
                dimensionScores,
                debugInfo,
                totalQuestions: Object.keys(responses).length
            };
        }

        function showResults(results) {
            document.getElementById('resultsContainer').style.display = 'block';
            
            // Update score displays
            document.getElementById('totalScore').textContent = `${results.totalScore}/${results.maxScore}`;
            document.getElementById('scorePercentage').textContent = `${results.percentage}%`;
            document.getElementById('resistanceLevel').textContent = results.level;
            document.getElementById('scoreCategory').textContent = results.category;
            document.getElementById('levelDescription').textContent = results.description;
            
            // Apply color classes
            const scoreClass = results.percentage >= 80 ? 'score-high' : 
                             results.percentage >= 60 ? 'score-medium' : 'score-low';
            
            document.getElementById('totalScore').className = `score-display ${scoreClass}`;
            document.getElementById('scorePercentage').className = `score-display ${scoreClass}`;
            document.getElementById('resistanceLevel').className = `score-display ${scoreClass}`;
            
            <!-- Show success message -->
            if (!document.getElementById('messageContainer').innerHTML) {
                document.getElementById('messageContainer').innerHTML = `
                    <div class="success-message">
                        ‚úÖ Assessment selesai! Skor dari 36 butir berhasil dihitung.
                        <br><small>üìù ${results.totalQuestions}/36 butir terjawab</small>
                        <br><small>üéØ Penomoran: Butir 1-36 (bukan 4-39)</small>
                        <br><small>üìä Skor maksimal: 144 poin</small>
                    </div>`;
            }
            
            // Generate dimension analysis
            generateDimensionAnalysis(results);
            
            // Generate recommendations
            generateRecommendations(results);
            
            // Update debug info
            updateDebugInfo(results);
        }

        function generateDimensionAnalysis(results) {
            const dims = results.dimensionScores;
            let analysis = '';
            
            Object.entries(dims).forEach(([dimension, data]) => {
                const percentage = Math.round((data.average / 4) * 100);
                const color = percentage >= 75 ? '#00ff00' : percentage >= 50 ? '#ffff00' : '#ff6b6b';
                
                analysis += `
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <h4 style="color: ${color};">${dimension}</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Skor: ${data.rawScore}/${data.count * 4}</span>
                            <span>Rata-rata: ${data.average.toFixed(2)}/4</span>
                            <span style="font-weight: bold; color: ${color};">${percentage}%</span>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); height: 8px; border-radius: 4px; margin-top: 8px;">
                            <div style="background: ${color}; height: 100%; width: ${percentage}%; border-radius: 4px; transition: width 0.3s ease;"></div>
                        </div>
                        <small style="color: #888;">Butir dalam dimensi ini: ${data.count} item</small>
                    </div>
                `;
            });
            
            document.getElementById('dimensionAnalysis').innerHTML = analysis;
        }

        function generateRecommendations(results) {
            const recommendations = [];
            const dims = results.dimensionScores;
            
            // Generate specific recommendations based on dimension scores
            Object.entries(dims).forEach(([dimension, data]) => {
                if (data.average < 3) {
                    switch(dimension) {
                        case 'Control':
                            recommendations.push("üéØ <strong>Control:</strong> Latih teknik relaksasi dan breathing exercise saat menghadapi soal matematika yang kompleks.");
                            break;
                        case 'Ownership':
                            recommendations.push("üéØ <strong>Ownership:</strong> Kembangkan sikap bertanggung jawab dengan membuat jadwal belajar mandiri dan aktif mencari sumber belajar tambahan.");
                            break;
                        case 'Reach':
                            recommendations.push("üéØ <strong>Reach:</strong> Fokuskan pada satu konsep matematika yang spesifik, jangan generalisasi kesulitan ke seluruh matematika.");
                            break;
                        case 'Endurance':
                            recommendations.push("üéØ <strong>Endurance:</strong> Tingkatkan ketekunan dengan membagi soal kompleks menjadi langkah-langkah kecil yang lebih mudah dikelola.");
                            break;
                    }
                }
            });
            
            // General recommendations based on overall score
            if (results.percentage >= 80) {
                recommendations.push("üåü <strong>Excellent!</strong> Pertahankan ketahanan yang baik dan jadilah mentor untuk teman-teman yang membutuhkan bantuan.");
            } else if (results.percentage >= 60) {
                recommendations.push("üìà <strong>Keep Growing:</strong> Fokus pada area yang masih lemah dan tingkatkan dengan latihan konsisten.");
            } else {
                recommendations.push("üí™ <strong>Building Resilience:</strong> Mulai dengan soal-soal dasar, bangun kepercayaan diri secara bertahap.");
            }
            
            recommendations.push("üìö <strong>Strategi Umum:</strong> Gunakan aplikasi matematika interaktif dan bergabung dengan kelompok belajar untuk meningkatkan motivasi.");
            
            document.getElementById('recommendations').innerHTML = recommendations.map(rec => `<p style="margin-bottom: 15px; line-height: 1.6;">${rec}</p>`).join('');
        }

        function updateDebugInfo(results) {
            const debugContent = `
                <strong>System Validation:</strong><br>
                ‚úì Question numbering: 1-36 (corrected)<br>
                ‚úì Personal info: No scoring<br>
                ‚úì Assessment items: 36 items<br>
                ‚úì Max possible score: 144 points<br><br>
                
                <strong>Current Results:</strong><br>
                Total Items Answered: ${results.totalQuestions}/36<br>
                Raw Total Score: ${results.totalScore}<br>
                Maximum Score: ${results.maxScore}<br>
                Percentage: ${results.percentage}%<br><br>
                
                <strong>Dimension Breakdown:</strong><br>
                ${Object.entries(results.dimensionScores).map(([dim, data]) => 
                    `${dim}: ${data.rawScore}/${data.count * 4} (avg: ${data.average.toFixed(2)}, items: ${data.count})`
                ).join('<br>')}
                <br><br>
                
                <strong>Sample Scoring:</strong><br>
                ${results.debugInfo.slice(0, 6).map(item => 
                    `Item ${item.questionId}: Input ${item.originalValue} ‚Üí Score ${item.finalScore} (${item.type})`
                ).join('<br>')}
                
                <br><br><strong>Validation:</strong><br>
                Score ‚â§ 144: ${results.totalScore <= 144 ? '‚úÖ Valid' : '‚ùå Error'}<br>
                All items 1-36: ${results.totalQuestions === 36 ? '‚úÖ Complete' : `‚ö†Ô∏è ${results.totalQuestions}/36`}
            `;
            document.getElementById('debugContent').innerHTML = debugContent;
        }

        function toggleDebug() {
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.style.display = debugDiv.style.display === 'none' ? 'block' : 'none';
        }

        function resetAssessment() {
            if (confirm('Apakah Anda yakin ingin mengulang assessment? Data saat ini akan hilang.')) {
                currentStep = 0;
                responses = {};
                personalInfo = {};
                
                document.getElementById('resultsContainer').style.display = 'none';
                document.getElementById('formContainer').style.display = 'block';
                document.getElementById('progressBar').style.display = 'none';
                document.getElementById('messageContainer').innerHTML = '';
                document.getElementById('debugInfo').style.display = 'none';
                
                // Reset form
                document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
                document.getElementById('step0').classList.add('active');
                
                // Clear inputs
                document.getElementById('namaLengkap').value = '';
                document.getElementById('kelas').value = '';
                document.getElementById('whatsapp').value = '';
                
                // Clear radio buttons
                document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
                
                updateNavigation();
            }
        }

        function downloadResults() {
            const results = calculateResults();
            const report = `
HASIL ASSESSMENT ADVERSITY QUOTIENT NUMERASI (CORRECTED VERSION)
================================================================

INFORMASI PRIBADI (Tidak Dinilai):
Nama: ${results.personalInfo.nama}
Kelas: ${results.personalInfo.kelas}
WhatsApp: ${results.personalInfo.whatsapp}
Tanggal: ${new Date().toLocaleDateString('id-ID')}
Waktu: ${new Date().toLocaleTimeString('id-ID')}

HASIL SKOR ANGKET:
Butir yang Dijawab: ${results.totalQuestions}/36
Skor Total: ${results.totalScore}/${results.maxScore}
Persentase: ${results.percentage}%
Kategori: ${results.category}
Level Ketahanan: ${results.level}

SISTEM PENSKORAN:
‚úì Penomoran Butir: 1 sampai 36 (bukan 4-39)
‚úì Informasi Pribadi: Tidak ada skor
‚úì Butir Angket: 36 item dengan skor 1-4
‚úì Skor Maksimal Teoritis: 144 poin (36 √ó 4)
‚úì Reverse Scoring: Diterapkan untuk item negatif

ANALISIS DIMENSI AQ:
- Control: ${results.dimensionScores.Control.rawScore}/${results.dimensionScores.Control.count * 4} (rata-rata: ${results.dimensionScores.Control.average.toFixed(2)}/4)
- Ownership: ${results.dimensionScores.Ownership.rawScore}/${results.dimensionScores.Ownership.count * 4} (rata-rata: ${results.dimensionScores.Ownership.average.toFixed(2)}/4)
- Reach: ${results.dimensionScores.Reach.rawScore}/${results.dimensionScores.Reach.count * 4} (rata-rata: ${results.dimensionScores.Reach.average.toFixed(2)}/4)
- Endurance: ${results.dimensionScores.Endurance.rawScore}/${results.dimensionScores.Endurance.count * 4} (rata-rata: ${results.dimensionScores.Endurance.average.toFixed(2)}/4)

DESKRIPSI HASIL:
${results.description}

VALIDASI:
- Skor tidak melebihi maksimal: ${results.totalScore <= 144 ? 'VALID' : 'ERROR'}
- Semua butir terjawab: ${results.totalQuestions === 36 ? 'LENGKAP' : 'BELUM LENGKAP'}

================================================================
Generated by AQ Assessment App (Corrected Numbering) 2025
Sistem: Butir 1-36 | Info Pribadi Tidak Dinilai | Max 144
            `;
            
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `AQ_Assessment_Corrected_${results.personalInfo.nama.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function viewSpreadsheet() {
            window.open(SPREADSHEET_URL, '_blank');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            generateQuestionSteps();
            updateConnectionStatus();
            console.log('üöÄ AQ Assessment initialized - Corrected numbering version');
            console.log('üìù Personal info: No scoring');
            console.log('üìä Assessment items: 1-36 (36 items)');
            console.log('üéØ Maximum possible score: 144 points');
            
            // Auto-save to localStorage as backup
            setInterval(() => {
                if (Object.keys(responses).length > 0) {
                    try {
                        localStorage.setItem('aq_backup', JSON.stringify({
                            responses,
                            personalInfo,
                            currentStep,
                            timestamp: new Date().toISOString()
                        }));
                    } catch (e) {
                        console.log('LocalStorage not available');
                    }
                }
            }, 30000); // Save every 30 seconds
        });

        // Test connection on page load
        window.addEventListener('load', function() {
            fetch(SCRIPT_URL)
                .then(() => {
                    console.log('‚úÖ Connection to Google Apps Script successful');
                })
                .catch(error => {
                    console.log('‚ö†Ô∏è Connection test failed:', error);
                });
        });
    </script>
</body>
</html>